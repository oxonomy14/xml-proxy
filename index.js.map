{"version":3,"file":"index.js","sources":["../src/js/form.js"],"sourcesContent":["let users = []; // Глобальная переменная\n\nfetch(`${import.meta.env.BASE_URL}data/users.json`)\n  .then(response => {\n    if (!response.ok) {\n      throw new Error(`Ошибка загрузки: ${response.status}`);\n    }\n    return response.json();\n  })\n  .then(data => {\n    users = data;\n  })\n  .catch(error => console.error(error));\n\nconst STORAGE_KEY = 'feedback-form-state';\n\nconst refs = {\n  form: document.querySelector('.feedback-form'),\n  container: document.querySelector('.feedback-message'),\n  title: document.querySelector('.sub-title'),\n  result: document.querySelector('.text-1'),\n  text2: document.querySelector('.text-2'),\n  text3: document.querySelector('.text-3'),\n};\n\nconst formData = {\n  email: '',\n  message: '',\n};\n\n//! Парсим xml обменника\n\nlet exchangeRate = null; // Глобальная переменная\n\nfetch(`${import.meta.env.BASE_URL}data/exprates.xml`)\n  .then(response => response.text())\n  .then(xmlText => {\n    const parser = new DOMParser();\n    const xmlDoc = parser.parseFromString(xmlText, 'application/xml');\n\n    const fromCurrency = 'SBERRUB';\n    const toCurrency = 'WIRETHB';\n\n    const exchangeNode = Array.from(xmlDoc.querySelectorAll('item')).find(\n      item =>\n        item.querySelector('from').textContent === fromCurrency &&\n        item.querySelector('to').textContent === toCurrency\n    );\n\n    if (exchangeNode) {\n      let exchangeRateOut = exchangeNode.querySelector('out').textContent;\n      let exchangeRateIn = exchangeNode.querySelector('in').textContent;\n      exchangeRate = (exchangeRateOut / exchangeRateIn).toFixed(4);\n\n      console.log(`Курс ${fromCurrency} → ${toCurrency}: ${exchangeRate}`);\n    } else {\n      console.log('Курс не найден');\n    }\n  })\n  .catch(error => console.error('Ошибка загрузки XML:', error));\n\n// Можно использовать exchangeRate в других частях кода\n// setTimeout(() => {\n//   console.log('Доступ к курсу через 2 секунды:', exchangeRate);\n// }, 200);\n\n//! Сохраняем значения в localStorage\n\nrefs.form.addEventListener('input', e => {\n  // console.log(e.currentTargettarget);\n  const email = e.currentTarget.elements.email.value; // currentTarget - элемент на котором происходит событие\n  // const message = e.currentTarget.elements.message.value;\n  //console.log(email, message);\n  const formData = { email }; // создаем обьект и кладем значение\n  //console.log(formData);\n  saveToLS(STORAGE_KEY, formData);\n});\n\ninitPage(); //!  Загружаем данные из localStorage\n\nfunction initPage() {\n  const formData = loadFromLS(STORAGE_KEY);\n  refs.form.elements.email.value = formData?.email || ''; // ? - если нет значения и не надо брать\n  //refs.form.elements.message.value = formData?.message || '';\n}\n\n//! Текущая дата\n\nconst today = new Date(); // Текущая дата\nconst day = String(today.getDate()).padStart(2, '0'); // День с ведущим нулем\nconst month = String(today.getMonth() + 1).padStart(2, '0'); // Месяц (январь = 0)\nconst year = today.getFullYear(); // Год\n\nconst formattedDate = `${day}.${month}.${year}`; // Форматируем дату\nconsole.log(formattedDate); // Например: 02.02.2024\n\n//!  submit - выводим информацию\n\nrefs.form.addEventListener('submit', e => {\n  e.preventDefault();\n  if (!e.currentTarget.elements.email.value) {\n    alert('Заполните поле Email для идентификации Вас');\n    return;\n  }\n  const email = e.currentTarget.elements.email.value.trim().toLowerCase(); // Получаем email и нормализуем\n  //const message = e.currentTarget.elements.message.value;\n\n  //localStorage.removeItem(STORAGE_KEY); // очищаем LocalStorage\n\n  const user = users.find(user => user.email.toLowerCase() === email);\n\n  if (user) {\n    refs.title.textContent = `${user.username}, ${user.titleCourse}`;\n    refs.result.textContent = `Стоимость сессии ${\n      user.price\n    } Бат, что на сегодня ${formattedDate} по текущему курсу обменника vipChanger 1 руб = ${exchangeRate} Бат составляет: ${Math.floor(\n      user.price / exchangeRate\n    )} руб.`;\n    refs.text3.textContent = `Куратор: ${user.teacher}`;\n\n    if (user.opt !== '') {\n      refs.text2.textContent = `Стоимость ${\n        user.opt\n      }-x занятий составит - ${Math.floor(\n        (user.priceOpt / exchangeRate) * user.opt\n      )} руб.`;\n    } else {\n      refs.text2.textContent = ``;\n    }\n  } else {\n    refs.result.textContent = 'Такой электронной почты нет в списке';\n  }\n\n  refs.form.reset();\n});\n\n//! функция для LocalStorage\n\nfunction saveToLS(key, value) {\n  const jsonData = JSON.stringify(value);\n  localStorage.setItem(key, jsonData);\n}\n\nfunction loadFromLS(key) {\n  const body = localStorage.getItem(key);\n  try {\n    const data = JSON.parse(body);\n    return data;\n  } catch {\n    return body;\n  }\n}\n"],"names":["users","response","data","error","STORAGE_KEY","refs","exchangeRate","xmlText","xmlDoc","fromCurrency","toCurrency","exchangeNode","item","exchangeRateOut","exchangeRateIn","formData","saveToLS","initPage","loadFromLS","today","day","month","year","formattedDate","email","user","key","value","jsonData","body"],"mappings":"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"}